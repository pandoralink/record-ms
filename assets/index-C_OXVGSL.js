import{b as I,u as U}from"./index-Dp9DsjWu.js";import{r as c}from"./index-DE9JW7L8.js";var V=function(r){return function(a,e){var t=c.useRef(!1);r(function(){return function(){t.current=!1}},[]),r(function(){if(!t.current)t.current=!0;else return a()},e)}},_=function(r){return typeof r=="function"},M=function(r){return typeof r>"u"};const F=V(c.useEffect);function A(r,a){if(r===a)return!0;for(var e=0;e<r.length;e++)if(!Object.is(r[e],a[e]))return!1;return!0}function T(r){var a=c.useRef(r);return a.current=r,a}var W=function(r){var a=T(r);c.useEffect(function(){return function(){a.current()}},[])},w=!!(typeof window<"u"&&window.document&&window.document.createElement);function y(r,a){if(w){if(!r)return a;var e;return _(r)?e=r():"current"in r?e=r.current:e=r,e}}var x=function(r){var a=function(e,t,n){var l=c.useRef(!1),f=c.useRef([]),s=c.useRef([]),i=c.useRef();r(function(){var v,g=Array.isArray(n)?n:[n],o=g.map(function(E){return y(E)});if(!l.current){l.current=!0,f.current=o,s.current=t,i.current=e();return}(o.length!==f.current.length||!A(f.current,o)||!A(s.current,t))&&((v=i.current)===null||v===void 0||v.call(i),f.current=o,s.current=t,i.current=e())}),W(function(){var v;(v=i.current)===null||v===void 0||v.call(i),l.current=!1})};return a},G=x(c.useEffect);function b(r,a,e){e===void 0&&(e={});var t=e.enable,n=t===void 0?!0:t,l=T(a);G(function(){if(n){var f=y(e.target,window);if(f!=null&&f.addEventListener){var s=function(i){return l.current(i)};return f.addEventListener(r,s,{capture:e.capture,once:e.once,passive:e.passive}),function(){f.removeEventListener(r,s,{capture:e.capture})}}}},[r,e.capture,e.once,e.passive,n],e.target)}var L="AHOOKS_SYNC_STORAGE_EVENT_NAME";function J(r){function a(e,t){t===void 0&&(t={});var n,l=t.listenStorageChange,f=l===void 0?!1:l,s=t.onError,i=s===void 0?function(u){console.error(u)}:s;try{n=r()}catch(u){i(u)}var v=function(u){return t.serializer?t.serializer(u):JSON.stringify(u)},g=function(u){return t.deserializer?t.deserializer(u):JSON.parse(u)};function o(){try{var u=n==null?void 0:n.getItem(e);if(u)return g(u)}catch(d){i(d)}return _(t.defaultValue)?t.defaultValue():t.defaultValue}var E=I(c.useState(o),2),R=E[0],m=E[1];F(function(){m(o())},[e]);var z=function(u){var d=_(u)?u(R):u;f||m(d);try{var S=void 0,C=n==null?void 0:n.getItem(e);M(d)?(S=null,n==null||n.removeItem(e)):(S=v(d),n==null||n.setItem(e,S)),dispatchEvent(new CustomEvent(L,{detail:{key:e,newValue:S,oldValue:C,storageArea:n}}))}catch(N){i(N)}},h=function(u){u.key!==e||u.storageArea!==n||m(o())},O=function(u){h(u.detail)};return b("storage",h,{enable:f}),b(L,O,{enable:f}),[R,U(z)]}return a}var B=J(function(){return w?localStorage:void 0});export{W as a,F as b,G as c,V as d,B as e,y as g,w as i,T as u};
