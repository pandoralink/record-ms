import{a as ge}from"./attach-properties-to-component-CxYBDbn1.js";import{h as I,g as Z,r as v,R as c}from"./index-BzfneoA9.js";import{m as B,c as R,w as F}from"./with-default-props-CJz_oMvJ.js";import{u as M}from"./index-CW2lH1zu.js";import{a as ye,u as he,M as Se,C as Ce,s as Ee,S as $e,r as Oe}from"./spin-loading-BUEA2cwN.js";import{S as je,r as ke}from"./should-render-BHEuclEH.js";import{u as ee,a as te}from"./react-spring-web.esm-D8lu2Y0j.js";import{w as Te}from"./with-stop-propagation-CDkAgc26.js";import{d as xe,u as we}from"./use-inner-visible-CVIP5rGv.js";import{u as ne,a as Ne}from"./use-gesture-react.esm-ByEQHnZU.js";import{u as re}from"./config-provider-Cb8MFuwX.js";import{u as G}from"./use-props-value-B20lLCbj.js";import{b as A}from"./bound-sRU-RDN8.js";import{e as _e,b as oe,u as Pe}from"./index-Cv4DLZ7G.js";import{h as Re,m as Ie,n as We}from"./context-C861iW53.js";import{S as Me}from"./safe-area-fZYJ_iXP.js";function Le(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var ae=Le,Ve=typeof I=="object"&&I&&I.Object===Object&&I,Ae=Ve,Be=Ae,Fe=typeof self=="object"&&self&&self.Object===Object&&self,De=Be||Fe||Function("return this")(),le=De,Ge=le,ze=function(){return Ge.Date.now()},Ue=ze,He=/\s/;function qe(t){for(var e=t.length;e--&&He.test(t.charAt(e)););return e}var Xe=qe,Ye=Xe,Je=/^\s+/;function Ke(t){return t&&t.slice(0,Ye(t)+1).replace(Je,"")}var Qe=Ke,Ze=le,et=Ze.Symbol,se=et,z=se,ie=Object.prototype,tt=ie.hasOwnProperty,nt=ie.toString,P=z?z.toStringTag:void 0;function rt(t){var e=tt.call(t,P),r=t[P];try{t[P]=void 0;var o=!0}catch{}var n=nt.call(t);return o&&(e?t[P]=r:delete t[P]),n}var ot=rt,at=Object.prototype,lt=at.toString;function st(t){return lt.call(t)}var it=st,U=se,ct=ot,ut=it,ft="[object Null]",dt="[object Undefined]",H=U?U.toStringTag:void 0;function mt(t){return t==null?t===void 0?dt:ft:H&&H in Object(t)?ct(t):ut(t)}var vt=mt;function pt(t){return t!=null&&typeof t=="object"}var bt=pt,gt=vt,yt=bt,ht="[object Symbol]";function St(t){return typeof t=="symbol"||yt(t)&&gt(t)==ht}var Ct=St,Et=Qe,q=ae,$t=Ct,X=NaN,Ot=/^[-+]0x[0-9a-f]+$/i,jt=/^0b[01]+$/i,kt=/^0o[0-7]+$/i,Tt=parseInt;function xt(t){if(typeof t=="number")return t;if($t(t))return X;if(q(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=q(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Et(t);var r=jt.test(t);return r||kt.test(t)?Tt(t.slice(2),r?2:8):Ot.test(t)?X:+t}var wt=xt,Nt=ae,V=Ue,Y=wt,_t="Expected a function",Pt=Math.max,Rt=Math.min;function It(t,e,r){var o,n,i,s,a,u,C=0,g=!1,S=!1,f=!0;if(typeof t!="function")throw new TypeError(_t);e=Y(e)||0,Nt(r)&&(g=!!r.leading,S="maxWait"in r,i=S?Pt(Y(r.maxWait)||0,e):i,f="trailing"in r?!!r.trailing:f);function y(m){var $=o,O=n;return o=n=void 0,C=m,s=t.apply(O,$),s}function k(m){return C=m,a=setTimeout(l,e),g?y(m):s}function T(m){var $=m-u,O=m-C,w=e-$;return S?Rt(w,i-O):w}function p(m){var $=m-u,O=m-C;return u===void 0||$>=e||$<0||S&&O>=i}function l(){var m=V();if(p(m))return d(m);a=setTimeout(l,T(m))}function d(m){return a=void 0,f&&o?y(m):(o=n=void 0,s)}function b(){a!==void 0&&clearTimeout(a),C=0,o=u=n=a=void 0}function h(){return a===void 0?s:d(V())}function E(){var m=V(),$=p(m);if(o=arguments,n=this,u=m,$){if(a===void 0)return k(u);if(S)return clearTimeout(a),a=setTimeout(l,e),y(u)}return a===void 0&&(a=setTimeout(l,e)),s}return E.cancel=b,E.flush=h,E}var Wt=It;const Mt=Z(Wt);function Lt(){var t=(typeof global>"u"?"undefined":typeof global)=="object"&&global&&global.Object===Object&&global,e=typeof self=="object"&&self&&self.Object===Object&&self;return t||e}Lt()||(global.Date=Date);function Vt(t,e){var r,o=Re(t),n=(r=e==null?void 0:e.wait)!==null&&r!==void 0?r:1e3,i=v.useMemo(function(){return Mt(function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return o.current.apply(o,_e([],oe(s),!1))},n,e)},[]);return Ie(function(){i.cancel()}),{run:i,cancel:i.cancel,flush:i.flush}}function At(t,e,r){var o=oe(v.useState({}),2),n=o[0],i=o[1],s=Vt(function(){i({})},r).run;v.useEffect(function(){return s()},e),We(t,[n])}var Bt=typeof Element<"u",Ft=typeof Map=="function",Dt=typeof Set=="function",Gt=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function L(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var r,o,n;if(Array.isArray(t)){if(r=t.length,r!=e.length)return!1;for(o=r;o--!==0;)if(!L(t[o],e[o]))return!1;return!0}var i;if(Ft&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(i=t.entries();!(o=i.next()).done;)if(!e.has(o.value[0]))return!1;for(i=t.entries();!(o=i.next()).done;)if(!L(o.value[1],e.get(o.value[0])))return!1;return!0}if(Dt&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(i=t.entries();!(o=i.next()).done;)if(!e.has(o.value[0]))return!1;return!0}if(Gt&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(r=t.length,r!=e.length)return!1;for(o=r;o--!==0;)if(t[o]!==e[o])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(n=Object.keys(t),r=n.length,r!==Object.keys(e).length)return!1;for(o=r;o--!==0;)if(!Object.prototype.hasOwnProperty.call(e,n[o]))return!1;if(Bt&&t instanceof Element)return!1;for(o=r;o--!==0;)if(!((n[o]==="_owner"||n[o]==="__v"||n[o]==="__o")&&t.$$typeof)&&!L(t[n[o]],e[n[o]]))return!1;return!0}return t!==t&&e!==e}var zt=function(e,r){try{return L(e,r)}catch(o){if((o.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw o}};const Ut=Z(zt),W="adm-popup",Ht=Object.assign(Object.assign({},xe),{closeOnSwipe:!1,position:"bottom"}),qt=t=>{const e=B(Ht,t),r=R(`${W}-body`,e.bodyClassName,`${W}-body-position-${e.position}`),{locale:o}=re(),[n,i]=v.useState(e.visible),s=v.useRef(null);ye(s,e.disableBodyScroll&&n?"strict":!1),M(()=>{e.visible&&i(!0)},[e.visible]);const a=he(),{percent:u}=ee({percent:e.visible?0:100,config:{precision:.1,mass:.4,tension:300,friction:30},onRest:()=>{var f,y;a.current||(i(e.visible),e.visible?(f=e.afterShow)===null||f===void 0||f.call(e):(y=e.afterClose)===null||y===void 0||y.call(e))}}),C=ne(({swipe:[,f]})=>{var y;e.closeOnSwipe&&(f===1&&e.position==="bottom"||f===-1&&e.position==="top")&&((y=e.onClose)===null||y===void 0||y.call(e))},{axis:"y",enabled:["top","bottom"].includes(e.position)}),g=we(n&&e.visible),S=Te(e.stopPropagation,F(e,c.createElement("div",Object.assign({className:W,onClick:e.onClick,style:{display:n?void 0:"none",touchAction:["top","bottom"].includes(e.position)?"none":"auto"}},C()),e.mask&&c.createElement(Se,{visible:g,forceRender:e.forceRender,destroyOnClose:e.destroyOnClose,onMaskClick:f=>{var y,k;(y=e.onMaskClick)===null||y===void 0||y.call(e,f),e.closeOnMaskClick&&((k=e.onClose)===null||k===void 0||k.call(e))},className:e.maskClassName,style:e.maskStyle,disableBodyScroll:!1,stopPropagation:e.stopPropagation}),c.createElement(te.div,{className:r,style:Object.assign(Object.assign({},e.bodyStyle),{pointerEvents:u.to(f=>f===0?"unset":"none"),transform:u.to(f=>e.position==="bottom"?`translate(0, ${f}%)`:e.position==="top"?`translate(0, -${f}%)`:e.position==="left"?`translate(-${f}%, 0)`:e.position==="right"?`translate(${f}%, 0)`:"none")}),ref:s},e.showCloseButton&&c.createElement("a",{className:R(`${W}-close-icon`,"adm-plain-anchor"),onClick:()=>{var f;(f=e.onClose)===null||f===void 0||f.call(e)},role:"button","aria-label":o.common.close},c.createElement(Ce,null)),e.children))));return c.createElement(je,{active:n,forceRender:e.forceRender,destroyOnClose:e.destroyOnClose},ke(e.getContainer,S))};function J(t,e,r){return t*e*r/(e+r*t)}function K(t,e,r,o,n=.15){return n===0?A(t,e,r):t<e?-J(e-t,o,n)+e:t>r?+J(t-r,o,n)+r:t}function Xt(t){if(t==null||t==="")return 0;const e=t.trim();return e.endsWith("px")?parseFloat(e):e.endsWith("rem")?parseFloat(e)*parseFloat(window.getComputedStyle(document.documentElement).fontSize):e.endsWith("vw")?parseFloat(e)*window.innerWidth/100:0}const j="adm-picker-view",ce=v.memo(t=>{const{value:e,column:r,renderLabel:o}=t;function n(l){t.onSelect(l,t.index)}const[{y:i},s]=ee(()=>({from:{y:0},config:{tension:400,mass:.8}})),a=v.useRef(!1),u=v.useRef(null),C=v.useRef(null),g=v.useRef(34);M(()=>{const l=C.current;l&&(g.current=Xt(window.getComputedStyle(l).getPropertyValue("height")))}),M(()=>{if(a.current||e===null)return;const l=r.findIndex(b=>b.value===e);if(l<0)return;const d=l*-g.current;s.start({y:d,immediate:i.goal!==d})},[e,r]),M(()=>{if(r.length===0)e!==null&&n(null);else if(!r.some(l=>l.value===e)){const l=r[0];n(l.value)}},[r,e]);function S(l){const d=l*-g.current;s.start({y:d});const b=r[l];b&&n(b.value)}const f=l=>{const{direction:[,d],distance:[,b],velocity:[,h],offset:[,E],last:m}=l;return{direction:d,distance:b,velocity:h,offset:E,last:m}},y=l=>{a.current=!0;const d=-((r.length-1)*g.current),b=0,{direction:h,last:E,velocity:m,offset:$}=f(l);if(E){a.current=!1;const O=$+m*h*50,w=A(O,d,b),_=-Math.round(w/g.current);S(_)}else{const O=$;s.start({y:K(O,d,b,g.current*50,.2)})}},k=l=>{a.current=!0;const d=-((r.length-1)*g.current),b=0,{direction:h,last:E,velocity:m,distance:$}=f(l),O=-h,w=i.get();if(E){a.current=!1;const _=m*O*50,ve=w+$*O+_,pe=A(ve,d,b),be=-Math.round(pe/g.current);S(be)}else{const _=w+$*O;s.start({y:K(_,d,b,g.current*50,.2)})}};ne(l=>{l.event.stopPropagation(),y(l)},{axis:"y",from:()=>[0,i.get()],filterTaps:!0,pointer:{touch:!0},target:u}),Ne(l=>{l.event.stopPropagation(),k(l)},{target:t.mouseWheel?u:void 0,axis:"y",from:()=>[0,i.get()],preventDefault:!0,eventOptions:Ee?{passive:!1}:void 0});let T=null;function p(){if(T===null)return null;const l=r[T],d=T-1,b=T+1,h=r[d],E=r[b];return c.createElement("div",{className:`${j}-column-accessible`},c.createElement("div",{className:`${j}-column-accessible-current`,role:"button","aria-label":l?`当前选择的是：${l.label}`:"当前未选择"},"-"),c.createElement("div",{className:`${j}-column-accessible-button`,onClick:()=>{h&&S(d)},role:h?"button":"text","aria-label":h?`选择上一项：${h.label}`:"没有上一项"},"-"),c.createElement("div",{className:`${j}-column-accessible-button`,onClick:()=>{E&&S(b)},role:E?"button":"text","aria-label":E?`选择下一项：${E.label}`:"没有下一项"},"-"))}return c.createElement("div",{className:`${j}-column`},c.createElement("div",{className:`${j}-item-height-measure`,ref:C}),c.createElement(te.div,{ref:u,style:{translateY:i},className:`${j}-column-wheel`,"aria-hidden":!0},r.map((l,d)=>{var b;const h=t.value===l.value;h&&(T=d);function E(){a.current=!1,S(d)}return c.createElement("div",{key:(b=l.key)!==null&&b!==void 0?b:l.value,"data-selected":h,className:R(`${j}-column-item`,{[`${j}-column-item-active`]:h}),onClick:E,"aria-hidden":!h,"aria-label":h?"active":""},c.createElement("div",{className:`${j}-column-item-label`},o(l)))})),p())},(t,e)=>!(t.index!==e.index||t.value!==e.value||t.onSelect!==e.onSelect||t.renderLabel!==e.renderLabel||t.mouseWheel!==e.mouseWheel||!Ut(t.column,e.column)));ce.displayName="Wheel";function Q(t){let e=null;return()=>(e===null&&(e=t()),e)}function ue(t,e){const r=Q(()=>(typeof t=="function"?t(e):t).map(s=>s.map(a=>typeof a=="string"?{label:a,value:a}:a))),o=Q(()=>e.map((i,s)=>{var a;const u=r()[s];return u&&(a=u.find(C=>C.value===i))!==null&&a!==void 0?a:null}));return{get columns(){return r()},get items(){return o()}}}function fe(t,e){return v.useMemo(()=>ue(t,e),[t,e])}const de=t=>t.label,N="adm-picker-view",Yt={defaultValue:[],renderLabel:de,mouseWheel:!1,loadingContent:c.createElement("div",{className:`${N}-loading-content`},c.createElement($e,null))},me=v.memo(t=>{const e=B(Yt,t),[r,o]=v.useState(e.value===void 0?e.defaultValue:e.value);v.useEffect(()=>{e.value!==void 0&&e.value!==r&&o(e.value)},[e.value]),v.useEffect(()=>{if(e.value===r)return;const a=window.setTimeout(()=>{e.value!==void 0&&e.value!==r&&o(e.value)},1e3);return()=>{window.clearTimeout(a)}},[e.value,r]);const n=fe(e.columns,r),i=n.columns;At(()=>{var a;e.value!==r&&((a=e.onChange)===null||a===void 0||a.call(e,r,n))},[r],{wait:0,leading:!1,trailing:!0});const s=v.useCallback((a,u)=>{o(C=>{const g=[...C];return g[u]=a,g})},[]);return F(e,c.createElement("div",{className:`${N}`},e.loading?e.loadingContent:c.createElement(c.Fragment,null,i.map((a,u)=>c.createElement(ce,{key:u,index:u,column:a,value:r[u],onSelect:s,renderLabel:e.renderLabel,mouseWheel:e.mouseWheel})),c.createElement("div",{className:`${N}-mask`},c.createElement("div",{className:`${N}-mask-top`}),c.createElement("div",{className:`${N}-mask-middle`}),c.createElement("div",{className:`${N}-mask-bottom`})))))});me.displayName="PickerView";const x="adm-picker",Jt={defaultValue:[],closeOnMaskClick:!0,renderLabel:de,destroyOnClose:!1,forceRender:!1},D=v.memo(v.forwardRef((t,e)=>{var r;const{locale:o}=re(),n=B(Jt,{confirmText:o.common.confirm,cancelText:o.common.cancel},t),[i,s]=G({value:n.visible,defaultValue:!1,onChange:p=>{var l;p===!1&&((l=n.onClose)===null||l===void 0||l.call(n))}}),a={toggle:()=>{s(p=>!p)},open:()=>{s(!0)},close:()=>{s(!1)}};v.useImperativeHandle(e,()=>a);const[u,C]=G(Object.assign(Object.assign({},n),{onChange:p=>{var l;const d=ue(n.columns,p);(l=n.onConfirm)===null||l===void 0||l.call(n,p,d)}})),g=fe(n.columns,u),[S,f]=v.useState(u);v.useEffect(()=>{S!==u&&f(u)},[i]),v.useEffect(()=>{i||f(u)},[u]);const y=Pe((p,l)=>{var d;f(p),i&&((d=n.onSelect)===null||d===void 0||d.call(n,p,l))}),k=F(n,c.createElement("div",{className:x},c.createElement("div",{className:`${x}-header`},c.createElement("a",{role:"button",className:`${x}-header-button`,onClick:()=>{var p;(p=n.onCancel)===null||p===void 0||p.call(n),s(!1)}},n.cancelText),c.createElement("div",{className:`${x}-header-title`},n.title),c.createElement("a",{role:"button",className:R(`${x}-header-button`,n.loading&&`${x}-header-button-disabled`),onClick:()=>{n.loading||(C(S,!0),s(!1))},"aria-disabled":n.loading},n.confirmText)),c.createElement("div",{className:`${x}-body`},c.createElement(me,{loading:n.loading,loadingContent:n.loadingContent,columns:n.columns,renderLabel:n.renderLabel,value:S,mouseWheel:n.mouseWheel,onChange:y})))),T=c.createElement(qt,{style:n.popupStyle,className:R(`${x}-popup`,n.popupClassName),visible:i,position:"bottom",onMaskClick:()=>{var p;n.closeOnMaskClick&&((p=n.onCancel)===null||p===void 0||p.call(n),s(!1))},getContainer:n.getContainer,destroyOnClose:n.destroyOnClose,afterShow:n.afterShow,afterClose:n.afterClose,onClick:n.onClick,forceRender:n.forceRender,stopPropagation:n.stopPropagation},k,c.createElement(Me,{position:"bottom"}));return c.createElement(c.Fragment,null,T,(r=n.children)===null||r===void 0?void 0:r.call(n,g.items,a))}));D.displayName="Picker";function Kt(t){return new Promise(e=>{const r=()=>{const[n,i]=v.useState(!1);return v.useEffect(()=>{i(!0)},[]),c.createElement(D,Object.assign({},t,{visible:n,onConfirm:(s,a)=>{var u;(u=t.onConfirm)===null||u===void 0||u.call(t,s,a),e(s)},onClose:()=>{var s;(s=t.onClose)===null||s===void 0||s.call(t),i(!1),e(null)},afterClose:()=>{var s;(s=t.afterClose)===null||s===void 0||s.call(t),o()}}))},o=Oe(c.createElement(r,null))})}const pn=ge(D,{prompt:Kt});export{pn as P};
