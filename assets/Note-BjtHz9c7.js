import{r as o,R as g,u as Y,j as x}from"./index-D0XnXfhO.js";import{m as I,w as P}from"./with-default-props-DVrlrL9p.js";import{C as Z}from"./card-DgHcQCAT.js";import{r as G}from"./index.esm-Cg_c7sd2.js";import{u as V}from"./index-DmSSIiMP.js";import{u as J}from"./index-CAYIEzTo.js";import{w as B}from"./with-stop-propagation-B3B-f0PH.js";import{u as K,a as Q,t as U}from"./react-spring-web.esm-Cg9vpMj8.js";import{u as ee,S as te,D as ne}from"./swipe-action-CK2ilZ_0.js";import{N as oe}from"./nav-bar-GNBDxfnF.js";import{S as z}from"./space-DBaVenS6.js";import{c as ie,d as se,l as re}from"./context-D8naPyMO.js";import"./isBrowser-CU3-RGUT.js";import"./button-C0G4TGoo.js";import"./validate-Uh6WP5mn.js";import"./index-C3KNqhou.js";function le(i){return o.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},i,{style:Object.assign({verticalAlign:"-0.125em"},i.style),className:["antd-mobile-icon",i.className].filter(Boolean).join(" ")}),o.createElement("g",{id:"AddOutline-AddOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},o.createElement("g",{id:"AddOutline-add"},o.createElement("rect",{id:"AddOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),o.createElement("path",{d:"M25.1,6.5 C25.3209139,6.5 25.5,6.6790861 25.5,6.9 L25.5,22.5 L41.1,22.5 C41.3209139,22.5 41.5,22.6790861 41.5,22.9 L41.5,25.1 C41.5,25.3209139 41.3209139,25.5 41.1,25.5 L25.5,25.5 L25.5,41.1 C25.5,41.3209139 25.3209139,41.5 25.1,41.5 L22.9,41.5 C22.6790861,41.5 22.5,41.3209139 22.5,41.1 L22.5,25.5 L6.9,25.5 C6.6790861,25.5 6.5,25.3209139 6.5,25.1 L6.5,22.9 C6.5,22.6790861 6.6790861,22.5 6.9,22.5 L22.5,22.5 L22.5,6.9 C22.5,6.6790861 22.6790861,6.5 22.9,6.5 L25.1,6.5 Z",id:"AddOutline-路径",fill:"currentColor",fillRule:"nonzero"}))))}function ae(i,e){const d=J(i);V(()=>{const u=e.current;if(u)if(window.ResizeObserver){let n;const s=new ResizeObserver(()=>{n=window.requestAnimationFrame(()=>d(u))});return s.observe(u),()=>{window.cancelAnimationFrame(n),s.disconnect()}}else d(u)},[e])}const ce="adm-ellipsis",de={direction:"end",rows:1,expandText:"",content:"",collapseText:"",stopPropagationForActionButtons:[],onContentClick:()=>{},defaultExpanded:!1},ue=i=>{const e=I(de,i),d=o.useRef(null),u=o.useRef(null),n=o.useRef(null),[s,r]=o.useState({}),[p,T]=o.useState(e.defaultExpanded),[S,F]=o.useState(!1),w=o.useMemo(()=>G(e.content),[e.content]);function l(f,y){return w.slice(f,y).join("")}function v(){var f,y;const h=d.current;if(!h)return;const C=h.style.display;h.style.display="block";const m=window.getComputedStyle(h),t=document.createElement("div");Array.prototype.slice.apply(m).forEach(b=>{t.style.setProperty(b,m.getPropertyValue(b))}),h.style.display=C,t.style.height="auto",t.style.minHeight="auto",t.style.maxHeight="auto",t.style.textOverflow="clip",t.style.webkitLineClamp="unset",t.style.display="block";const _=D(m.lineHeight),A=Math.floor(_*(e.rows+.5)+D(m.paddingTop)+D(m.paddingBottom));if(t.innerText=e.content,document.body.appendChild(t),t.offsetHeight<=A)F(!1);else{let R=function(a,c){if(c-a<=1)return e.direction==="end"?{leading:l(0,a)+"..."}:{tailing:"..."+l(c,b)};const E=Math.round((a+c)/2);return e.direction==="end"?t.innerHTML=l(0,E)+"..."+j:t.innerHTML=j+"..."+l(E,b),t.offsetHeight<=A?e.direction==="end"?R(E,c):R(a,E):e.direction==="end"?R(a,E):R(E,c)},O=function(a,c){if(a[1]-a[0]<=1&&c[1]-c[0]<=1)return{leading:l(0,a[0])+"...",tailing:"..."+l(c[1],b)};const E=Math.floor((a[0]+a[1])/2),H=Math.ceil((c[0]+c[1])/2);return t.innerHTML=l(0,E)+"..."+j+"..."+l(H,b),t.offsetHeight<=A?O([E,a[1]],[c[0],H]):O([a[0],E],[H,c[1]])};F(!0);const b=e.content.length,W=typeof e.collapseText=="string"?e.collapseText:(f=n.current)===null||f===void 0?void 0:f.innerHTML,X=typeof e.expandText=="string"?e.expandText:(y=u.current)===null||y===void 0?void 0:y.innerHTML,j=p?W:X,$=Math.floor((0+b)/2),q=e.direction==="middle"?O([0,$],[$,b]):R(0,b);r(q)}document.body.removeChild(t)}ae(v,d),V(()=>{v()},[e.content,e.direction,e.rows,e.expandText,e.collapseText]);const k=!!e.expandText&&B(e.stopPropagationForActionButtons,g.createElement("a",{ref:u,onClick:()=>{T(!0)}},e.expandText)),L=!!e.collapseText&&B(e.stopPropagationForActionButtons,g.createElement("a",{ref:n,onClick:()=>{T(!1)}},e.collapseText)),N=()=>S?p?g.createElement(g.Fragment,null,e.content,L):g.createElement(g.Fragment,null,s.leading,k,s.tailing):e.content;return P(e,g.createElement("div",{ref:d,className:ce,onClick:f=>{f.target===f.currentTarget&&e.onContentClick(f)}},N()))};function D(i){if(!i)return 0;const e=i.match(/^\d*(\.\d*)?/);return e?Number(e[0]):0}const M="adm-floating-bubble",fe={axis:"y",defaultOffset:{x:0,y:0}},pe=i=>{const e=I(fe,i),d=o.useRef(null),u=o.useRef(null),[n,s]=o.useState(e.offset===void 0?e.defaultOffset:e.offset);o.useEffect(()=>{e.offset!==void 0&&S.start({x:e.offset.x,y:e.offset.y})},[e.offset]);const[{x:r,y:p,opacity:T},S]=K(()=>({x:n.x,y:n.y,opacity:1})),F=ee(w=>{var l;let v=w.offset[0],k=w.offset[1];if(w.last&&e.magnetic){const N=d.current,f=u.current;if(!N||!f)return;const y=N.getBoundingClientRect(),h=f.getBoundingClientRect();if(e.magnetic==="x"){const C=r.goal-r.get(),m=h.left+C-y.left,t=y.right-(h.right+C);t<=m?v+=t:v-=m}else if(e.magnetic==="y"){const C=p.goal-p.get(),m=h.top+C-y.top,t=y.bottom-(h.bottom+C);t<=m?k+=t:k-=m}}const L={x:v,y:k};e.offset===void 0?S.start(L):s(L),(l=e.onOffsetChange)===null||l===void 0||l.call(e,L),S.start({opacity:w.active?.8:1})},{axis:e.axis==="xy"?void 0:e.axis,pointer:{touch:!0},filterTaps:!0,bounds:d,from:()=>[r.get(),p.get()]});return P(e,g.createElement("div",{className:M},g.createElement("div",{className:`${M}-boundary-outer`},g.createElement("div",{className:`${M}-boundary`,ref:d})),g.createElement(Q.div,Object.assign({},F(),{style:{opacity:T,transform:U([r,p],(w,l)=>`translate(${w}px, ${l}px)`)},onClick:e.onClick,className:`${M}-button`,ref:u}),e.children)))},Me=()=>{const i=Y(),e=ie(),d=se(),u=o.useMemo(()=>{const n=re.cloneDeep(e||[]).map(s=>{console.log("item.noteId",s.noteId);const r=new Date(s.noteId),p=`${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")} ${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}`;return{...s,time:p}});return n.sort((s,r)=>r.noteId-s.noteId),n},[e]);return x.jsxs(x.Fragment,{children:[x.jsx(oe,{style:{backgroundColor:"#f2f2f7",fontWeight:500},back:null,children:"随记"}),x.jsx(z,{direction:"vertical",style:{backgroundColor:"#f2f2f7",padding:"16px",width:"100%",boxSizing:"border-box"},children:u.map(n=>x.jsx(te,{style:{borderRadius:8},rightActions:[{key:"delete",text:x.jsx(ne,{fontSize:36}),color:"danger",onClick:s=>{s.stopPropagation(),d(r=>(r||[]).filter(p=>p.noteId!==n.noteId))}}],children:x.jsx(Z,{title:n.title,bodyStyle:{textAlign:"left",overflow:"hidden"},onClick:()=>{i({pathname:"/note-detail",search:`noteId=${n.noteId}`})},children:x.jsxs(z,{children:[n.time,x.jsx(ue,{direction:"end",content:n.content.slice(0,100),style:{wordBreak:"break-word"}})]})},n.noteId)}))}),x.jsx(pe,{axis:"x",magnetic:"x",style:{"--initial-position-bottom":"100px","--initial-position-right":"24px","--edge-distance":"24px"},onClick:()=>{i("/note-detail")},children:x.jsx(le,{fontSize:32})})]})};export{Me as Note};
