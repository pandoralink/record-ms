import{c as U,u as V}from"./index-9nx2DlAH.js";import{r as c}from"./index-4K8MCTj1.js";import{i as b}from"./isBrowser-CU3-RGUT.js";var M=function(r){return function(a,e){var t=c.useRef(!1);r(function(){return function(){t.current=!1}},[]),r(function(){if(!t.current)t.current=!0;else return a()},e)}},_=function(r){return typeof r=="function"},F=function(r){return typeof r>"u"};const W=M(c.useEffect);function A(r,a){if(r===a)return!0;for(var e=0;e<r.length;e++)if(!Object.is(r[e],a[e]))return!1;return!0}function z(r){var a=c.useRef(r);return a.current=r,a}var x=function(r){var a=z(r);c.useEffect(function(){return function(){a.current()}},[])};function O(r,a){if(b){if(!r)return a;var e;return _(r)?e=r():"current"in r?e=r.current:e=r,e}}var G=function(r){var a=function(e,t,n){var l=c.useRef(!1),f=c.useRef([]),s=c.useRef([]),i=c.useRef();r(function(){var v,g=Array.isArray(n)?n:[n],o=g.map(function(E){return O(E)});if(!l.current){l.current=!0,f.current=o,s.current=t,i.current=e();return}(o.length!==f.current.length||!A(f.current,o)||!A(s.current,t))&&((v=i.current)===null||v===void 0||v.call(i),f.current=o,s.current=t,i.current=e())}),x(function(){var v;(v=i.current)===null||v===void 0||v.call(i),l.current=!1})};return a},J=G(c.useEffect);function L(r,a,e){e===void 0&&(e={});var t=e.enable,n=t===void 0?!0:t,l=z(a);J(function(){if(n){var f=O(e.target,window);if(f!=null&&f.addEventListener){var s=function(i){return l.current(i)};return f.addEventListener(r,s,{capture:e.capture,once:e.once,passive:e.passive}),function(){f.removeEventListener(r,s,{capture:e.capture})}}}},[r,e.capture,e.once,e.passive,n],e.target)}var T="AHOOKS_SYNC_STORAGE_EVENT_NAME";function Y(r){function a(e,t){t===void 0&&(t={});var n,l=t.listenStorageChange,f=l===void 0?!1:l,s=t.onError,i=s===void 0?function(u){console.error(u)}:s;try{n=r()}catch(u){i(u)}var v=function(u){return t.serializer?t.serializer(u):JSON.stringify(u)},g=function(u){return t.deserializer?t.deserializer(u):JSON.parse(u)};function o(){try{var u=n==null?void 0:n.getItem(e);if(u)return g(u)}catch(d){i(d)}return _(t.defaultValue)?t.defaultValue():t.defaultValue}var E=U(c.useState(o),2),R=E[0],m=E[1];W(function(){m(o())},[e]);var y=function(u){var d=_(u)?u(R):u;f||m(d);try{var S=void 0,N=n==null?void 0:n.getItem(e);F(d)?(S=null,n==null||n.removeItem(e)):(S=v(d),n==null||n.setItem(e,S)),dispatchEvent(new CustomEvent(T,{detail:{key:e,newValue:S,oldValue:N,storageArea:n}}))}catch(I){i(I)}},h=function(u){u.key!==e||u.storageArea!==n||m(o())},C=function(u){h(u.detail)};return L("storage",h,{enable:f}),L(T,C,{enable:f}),[R,V(y)]}return a}var H=Y(function(){return b?localStorage:void 0});export{J as a,x as b,W as c,M as d,H as e,O as g,z as u};
